<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>華夫格格管理系統</title>
<!-- React & Babel & Tailwind -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<style>
body { font-family: 'Noto Sans TC', sans-serif; background-color: #FDF8F5; margin: 0; padding: 0; }
.no-scrollbar::-webkit-scrollbar { display: none; }
input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.receipt-card { background-color: #FDF8F5; padding: 1.5rem; border-radius: 2.5rem; box-shadow: inset 0 2px 10px rgba(0,0,0,0.05); }
.animate-fade { animation: fadeIn 0.3s ease-out; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
// Firebase 設定
const firebaseConfig = {
  apiKey: "AIzaSyDKid1UpSAI3CGV2P54BRkv8ladJG0Udak",
  authDomain: "waffle-63ce6.firebaseapp.com",
  projectId: "waffle-63ce6",
  storageBucket: "waffle-63ce6.appspot.com",
  messagingSenderId: "889169467838",
  appId: "1:889169467838:web:32045ccf925df38ffac1ef",
  measurementId: "G-QFRWH5NY9C"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const { useState, useMemo, useEffect } = React;

// --- 你的原本的 Icon、flavorNames、extraNames、bankInfo、productCategories、calculatePacking、getDoughDemand ---
const Icon = ({ name, size = 20, className = "" }) => {
  const icons = {
    plus: <path d="M12 5v14M5 12h14" />,
    minus: <path d="M5 12h14" />,
    user: <g><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></g>,
    trash: <g><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></g>,
    edit: <g><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></g>,
    cart: <g><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></g>,
    chef: <g><path d="M6 18h12"/><path d="M12 10V4.5a2.5 2.5 0 0 0-5 0V10a2 2 0 0 1-2 2h0a2 2 0 0 1-2-2V8"/><path d="M12 10V4.5a2.5 2.5 0 0 1 5 0V10a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V8"/><path d="M18 18a4 4 0 1 1-8 0"/></g>,
    back: <g><polyline points="15 18 9 12 15 6"/></g>,
    close: <g><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></g>,
    chart: <g><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></g>,
    pin: <g><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></g>,
    truck: <g><rect width="16" height="10" x="2" y="6" rx="2"/><path d="M18 8h3l3 3v5h-6"/><circle cx="6.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></g>,
    card: <g><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></g>,
    clipboard: <g><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></g>,
    check: <polyline points="20 6 9 17 4 12"/>,
    undo: <g><path d="M3 7V5c0-1.1.9-2 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/><polyline points="9 11 12 14 15 11"/></g>,
    send: <g><line x1="22" y1="2" x2="11" y2="13"/><polyline points="22 2 15 22 11 13 2 9 22 2"/></g>,
    target: <g><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></g>,
    gift: <g><rect width="18" height="14" x="3" y="8" rx="2"/><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0 5.997 0A4 4 0 0 0 17.997 5.125 3 3 0 1 0 12 5Z"/><line x1="12" x2="12" y1="22" y2="8"/></g>
  };
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
      {icons[name] || <circle cx="12" cy="12" r="10" />}
    </svg>
  );
};

const flavorNames = { original: '原味', strawberry: '草莓', cocoa: '可可', matcha: '抹茶' };
const extraNames = { cream: '鮮奶油', bag: '提袋費($2)', receipt: '收據', sugar: '糖粉', fork: '叉子' };
const bankInfo = { bankName: "中國信託 (822)", accountName: "彭永翔", accountNumber: "1755 4046 3472" };

// ...（productCategories、calculatePacking、getDoughDemand 請照你原本的內容貼上）

// 這裡省略 productCategories、calculatePacking、getDoughDemand，請直接貼你原本的內容

const App = () => {
  // ...（你的 useState、useMemo、useEffect 等照原本貼上）

  // Firestore 雲端同步
  const [orders, setOrders] = useState([]);
  useEffect(() => {
    const unsubscribe = db.collection("orders").orderBy("isoDate", "desc")
      .onSnapshot((snapshot) => {
        const orderList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        setOrders(orderList);
      });
    return () => unsubscribe();
  }, []);

  // ...（activeOrders、historyOrders、其他計算函式照原本貼上）

  // 儲存訂單（新增/編輯）
  const handleSave = () => {
    if (!currentOrder.name || currentOrder.items.length === 0) return;
    const now = new Date();
    const orderData = {
      ...currentOrder,
      totalAmount: currentOrder.items.reduce((s, i) => s + (i.price * (i.qty || 0)), 0) + (currentOrder.extras.bag ? (calculatePacking(currentOrder.items).bag6 + calculatePacking(currentOrder.items).bag4) * 2 : 0),
      timestamp: now.toLocaleString(),
      isoDate: now.toISOString(),
      completed: false
    };
    if (editingId) {
      db.collection("orders").doc(editingId).set(orderData).then(() => setEditingId(null));
    } else {
      db.collection("orders").add(orderData);
    }
    setCurrentOrder({ name: '', phone: '', address: '', deliveryTime: '', deliveryMethod: '自取', paymentMethod: '店內結帳', note: '', items: [], extras: { cream: false, bag: true, receipt: false, sugar: false, fork: false }, completed: false });
    setActiveTab('list');
    setListSubTab('active');
  };

  // 刪除訂單
  const handleDelete = (id) => {
    db.collection("orders").doc(id).delete();
  };

  // 標記完成/還原
  const toggleComplete = (id, completed) => {
    db.collection("orders").doc(id).update({ completed: !completed });
  };

  // ...（其餘 UI、渲染邏輯請照你原本貼上）

  return (
    // ...（你的原本 return 內容照貼即可）
    <div>請貼上你的原本 return 內容</div>
  );
};

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
